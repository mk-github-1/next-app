SharePoint Rest APIメモ

REST を使用してフォルダーとファイルを操作する
https://learn.microsoft.com/ja-jp/sharepoint/dev/sp-add-ins/working-with-folders-and-files-with-rest

-----

# ドキュメントライブラリ
※ブラウザで確認のみでよいかも
ブラウザ上はダウンロード、バックエンドであればバイナリが取得されるはず

## フォルダ内のすべてのファイルを取得
GET https://{tenant-name}.sharepoint.com/sites/{site-collection-name}/_api/web/GetFolderByServerRelativeUrl('/Folder Name')/Files
method: GET
Authorization: "Bearer " + accessToken
Accept: "application/json;odata=verbose"

## 特定のファイルを取得 ※実用的？
GET https://{tenant-name}.sharepoint.com/sites/{site-collection-name}/_api/web/GetFolderByServerRelativeUrl('/Folder Name')/Files('{file_name}')/$value
Authorization: "Bearer " + accessToken

## URLがわかっている場合はファイルを取得する ※URLだと変動がありそう
GET https://{tenant-name}.sharepoint.com/sites/{site-collection-name}/_api/web/GetFileByServerRelativeUrl('/Folder Name/{file_name}')/$value
Authorization: "Bearer " + accessToken

## ファイルを作成してフォルダーに追加する
POST https://{tenant-name}.sharepoint.com/sites/{site-collection-name}/_api/web/GetFolderByServerRelativeUrl('/Folder Name')/Files/add(url='a.txt',overwrite=true)
Authorization: "Bearer " + accessToken
Content-Length: {length of request body as integer}
X-RequestDigest: "{form_digest_value}"

"Contents of file"

## PUT メソッドを使用してファイルを更新する ※ファイルはPATCHでなくPUTを使用
POST https://{tenant-name}.sharepoint.com/sites/{site-collection-name}/_api/web/GetFileByServerRelativeUrl('/Folder Name/{file_name}')/$value
Authorization: "Bearer " + accessToken
Content-Length: {length of request body as integer}
X-HTTP-Method: "PUT"
X-RequestDigest: "{form_digest_value}"

"Contents of file"

## ファイルをチェックアウトする
POST https://{tenant-name}.sharepoint.com/sites/{site-collection-name}/_api/web/GetFileByServerRelativeUrl('/Folder Name/{file_name}')/CheckOut(),
Authorization: "Bearer " + accessToken
X-RequestDigest: "{form_digest_value}"

## ファイルをチェックインする
POST https://{tenant-name}.sharepoint.com/sites/{site-collection-name}/_api/web/GetFileByServerRelativeUrl('/Folder Name/{file_name}')/CheckIn(comment='Comment',checkintype=0)
Authorization: "Bearer " + accessToken
X-RequestDigest: "{form_digest_value}"

## ファイルを削除する
POST https://{tenant-name}.sharepoint.com/sites/{site-collection-name}/_api/web/GetFileByServerRelativeUrl('/Folder Name/{file_name}')
Authorization: "Bearer " + accessToken
If-Match: "{etag or *}"
X-HTTP-Method: "DELETE"
X-RequestDigest: "{form_digest_value}"

-----

# リスト
※list_titleは英語名、またはエンコード文字の両方のパターンがある

## リストアイテムに添付されているすべてのファイルを取得する
GET https://{tenant-name}.sharepoint.com/sites/{site-collection-name}/_api/web/lists/getbytitle('{list_title}')/items({item_id})/AttachmentFiles/
Authorization: "Bearer " + accessToken
Accept: "application/json;odata=verbose"

## リストアイテムに添付されているファイルを取得する
GET https://{tenant-name}.sharepoint.com/sites/{site-collection-name}/_api/web/lists/getbytitle('{list_title}')/items({item_id})/AttachmentFiles('{file_name}')/$value
Authorization: "Bearer " + accessToken
Accept: "application/json;odata=verbose"

## リストアイテムの添付ファイルを作成する
POST https://{tenant-name}.sharepoint.com/sites/{site-collection-name}/_api/web/lists/getbytitle('{list_title}')/items({item_id})/AttachmentFiles/ add(FileName='{file_name}')
Authorization: "Bearer " + accessToken
Content-Length: {length of request body as integer}
X-RequestDigest: "{form_digest_value}"

"Contents of file"

## PUTメソッドを使用してリストアイテムの添付ファイルを更新する
POST https://{tenant-name}.sharepoint.com/sites/{site-collection-name}/_api/web/lists/getbytitle('{list_title}')/items({item_id})/AttachmentFiles('{file_name}')/$value
Authorization: "Bearer " + accessToken
Content-Length: {length of request body as integer}
X-HTTP-Method: "PUT"
X-RequestDigest: "{form_digest_value}"

"Contents of file"
